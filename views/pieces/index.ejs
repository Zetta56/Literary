<%- include("../partials/header") %>

		<div class="ui massive message">
			<h1 class="ui large header">View Our Collections</h1>
			<p>Read through all these stories, poems, articles, and more posted by individuals around the web!</p>
			<a href="/pieces/new" class="ui large primary button">Add New Piece</a>
		</div>

		<div class="ui container">
			<div id="gallery" class="ui stackable three column grid container">
				<% pieces.forEach(piece => { %>
					<div class="column">
						<div class="ui card indexCard">
							<div id="topBar">
								<div class="ui label right floated item">
									Likes
									<div class="detail"><%= piece["likes"].length %></div>
								</div>
							</div>
							<div class="content">
								<div class="header">
									<h2><a href="/pieces/<%= piece["_id"] %>"><%= piece["title"] %></a></h2>
								</div>
								<div class="meta">
									<%= moment(piece["created"]).fromNow() %>, by 
									<a href="/users/<%= piece["author"]["id"] %>"><%= piece["author"]["username"] %></a>
								</div>
								<p class="textBody"><%= piece["body"].slice(0, 300) %>...</p>
							</div>
							<div id="bottomBar">
								<% if(currentUser && piece["likes"].some(like => {
									return like.equals(currentUser._id);
								})) { %>
									<a href="/pieces/<%= piece["_id"] %>/likes"><i class="fas fa-thumbs-up like"></i></a>
								<% } else { %>
									<i class="far fa-thumbs-up"></i>
									<a href="/pieces/<%= piece["_id"] %>/likes"><i class="fas fa-thumbs-up"></i></a>
								<% } %>
								<i class="far fa-heart"></i>
									<a><i class="fas fa-heart"></i></a>
							</div>
						</div>
					</div>
				<% }) %>
			</div>
			
			<div id="pagination">
				<% if (pages && pages > 1) { %>
					<ul class="ui pagination menu">
						<% if (current == 1) { %>
							<a class="disabled item">First</a>
							<a class="disabled item">&lt;</a>
						<% } else { %>
							<a href="/pieces" class="item">First</a>
							<a href="/pieces?page=<%= Number(current) - 1 %>" class="item">&lt;</a>
						<% } %>
						<% var i = (Number(current) > 5 ? Number(current) - 4 : 1) %>
						<% if (i !== 1) { %>
							<a class="active item">...</a>
						<% } %>
						<% for (i ; i <= (Number(current) + 4) && i <= pages; i++) { %>
							<% if (i == current) { %>
								<a class="active item"><%= i %></a>
							<% } else { %>
								<a href="/pieces?page=<%= i %>" class="item"><%= i %></a>
							<% } %>
							<% if (i == Number(current) + 4 && i < pages) { %>
								<a class="active item">...</a>
							<% } %>
						<% } %>
						<% if (current == pages) { %>
							<a class="disabled item">&gt;</a>
							<a class="disabled item">Last</a>
						<% } else { %>
							<a href="/pieces?page=<%= Number(current) + 1 %>" class="item">&gt;</a>
							<a href="/pieces?page=<%= pages %>"class="item">Last</a>
						<% } %>
					</ul>
				<% } %>
			</div>
		</div>

<%- include("../partials/footer") %>